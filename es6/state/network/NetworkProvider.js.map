{"version":3,"file":"NetworkProvider.js","sources":["../../../src/state/network/NetworkProvider.tsx"],"sourcesContent":["import React, { useEffect, useReducer, useMemo } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { reducer, initialState as defaultState } from './reducer';\nimport { updateData, fetchFile, updateScrollToIndex } from './actions';\nimport { NetworkContext } from './Context';\nimport { findRequestIndex } from '../../utils';\nimport { ROW_ID_PREFIX } from '../../constants';\n\nconst NetworkProvider = (props) => {\n  const {\n    data,\n    file,\n    fetchOptions,\n    initialState,\n    scrollTimeStamp,\n    scrollRequestPosition,\n    autoHighlightChange,\n    onDataLoaded,\n    onDataError,\n  } = props;\n\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const value = useMemo(() => [state, dispatch], [state]);\n  const selectedReqIndex = value[0].get('selectedReqIndex');\n  const requestData = value[0].get('data');\n  const showReqDetail = value[0].get('showReqDetail');\n  const actualData = value[0].get('actualData');\n  const error = value[0].get('error');\n\n  // Update data onChange of network data\n  useEffect(() => {\n    if (data && data.log && data.log.entries) {\n      updateData(dispatch)({\n        entries: data.log.entries,\n        pages: data.log.pages,\n      });\n    }\n  }, [data]);\n\n  // Fetch HAR file onChange of file prop\n  useEffect(() => {\n    if (file) {\n      fetchFile(dispatch)(file, fetchOptions);\n    }\n  }, [file]);\n\n  useEffect(() => {\n    if (actualData.size && onDataLoaded) {\n      onDataLoaded(actualData);\n    }\n  }, [actualData]);\n\n  useEffect(() => {\n    if (error && onDataError) {\n      onDataError(error);\n    }\n  }, [error]);\n\n  // Find nearby request-rowId and update scrollIndex on scrollTimeStamp receive\n  useEffect(() => {\n    const shouldChangeHighlight = showReqDetail ? autoHighlightChange : true;\n    if (scrollTimeStamp && shouldChangeHighlight) {\n      const reqIndex = findRequestIndex({\n        data: requestData,\n        timestamp: scrollTimeStamp,\n        position: scrollRequestPosition,\n      });\n      if (reqIndex || reqIndex === 0) {\n        updateScrollToIndex(dispatch)(requestData.get(reqIndex));\n      }\n    }\n  }, [scrollTimeStamp, actualData]);\n\n  // Scroll to request row onChange of scrollToIndex\n  // setTimeout is required when reqDetail is visible,\n  // it allows DOM to adjust before we scroll it to highlighted request\n  useEffect(() => {\n    if (selectedReqIndex) {\n      setTimeout(() => {\n        const element = document.getElementById(ROW_ID_PREFIX + selectedReqIndex);\n        if (element) {\n          element.scrollIntoView({\n            alignToTop: true,\n            behavior: 'smooth',\n          });\n        }\n      }, 300);\n    }\n  }, [selectedReqIndex]);\n\n  return (\n    <NetworkContext.Provider\n      value={value}\n      {...props}\n    />\n  );\n};\n\nNetworkProvider.propTypes = {\n  autoHighlightChange: PropTypes.bool,\n  data: PropTypes.object,\n  fetchOptions: PropTypes.object,\n  file: PropTypes.string,\n  initialState: PropTypes.object,\n  onDataError: PropTypes.func,\n  onDataLoaded: PropTypes.func,\n  scrollRequestPosition: PropTypes.oneOf(['before', 'after', 'near']),\n  scrollTimeStamp: PropTypes.number,\n};\n\nNetworkProvider.defaultProps = {\n  autoHighlightChange: false,\n  data: null,\n  fetchOptions: { withCredentials: true },\n  file: null,\n  initialState: defaultState,\n  onDataError: null,\n  onDataLoaded: null,\n  scrollRequestPosition: 'near',\n  scrollTimeStamp: null,\n};\n\nexport default NetworkProvider;\n"],"names":["NetworkProvider","props","data","file","fetchOptions","initialState","scrollTimeStamp","scrollRequestPosition","autoHighlightChange","onDataLoaded","onDataError","useReducer","reducer","state","dispatch","value","useMemo","selectedReqIndex","get","requestData","showReqDetail","actualData","error","useEffect","log","entries","updateData","pages","fetchFile","size","shouldChangeHighlight","reqIndex","findRequestIndex","timestamp","position","updateScrollToIndex","setTimeout","element","document","getElementById","ROW_ID_PREFIX","scrollIntoView","alignToTop","behavior","propTypes","PropTypes","bool","object","string","func","oneOf","number","defaultProps","withCredentials","defaultState"],"mappings":"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"}