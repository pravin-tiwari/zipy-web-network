{"version":3,"file":"reducer.js","sources":["../../../src/state/network/reducer.ts"],"sourcesContent":["import { Map, List } from 'immutable';\n\nimport { filterData, sortBy, prepareViewerData, calculateTimings, getSummary } from './../../utils';\nimport * as types from './types';\n\nconst initialState = new Map({\n  data: new List(),\n  actualData: new List(),\n  totalNetworkTime: null,\n  dataSummary: new Map(),\n  sort: {\n    key: 'startedDateTime',\n    isAcs: true,\n  },\n  search: {\n    name: 'url',\n    value: '',\n  },\n  filter: {\n    name: null,\n    value: null,\n  },\n  errorFilter: false,\n  error: null,\n  loading: false,\n  scrollToIndex: null,\n  selectedReqIndex: null,\n  showReqDetail: false,\n  reqDetail: null,\n});\n\nconst reducer = (state = initialState, { type, payload }) => {\n  switch (type) {\n    case types.UPDATE_DATA: {\n      return state.withMutations((newState) => {\n        const sort = state.get('sort');\n        const {\n          data,\n          totalNetworkTime,\n          totalRequests,\n          totalTransferredSize,\n          totalUncompressedSize,\n          finishTime,\n        } = prepareViewerData(payload.entries);\n        const sortedData = new List(sortBy(data, sort.key, sort.isAcs));\n        newState\n          .set('error', null)\n          .set('data', sortedData)\n          .set('actualData', sortedData)\n          .set('totalNetworkTime', totalNetworkTime)\n          .set('dataSummary', new Map({\n            totalRequests,\n            totalTransferredSize,\n            totalUncompressedSize,\n            finishTime,\n            timings: calculateTimings(payload.pages),\n            finish: finishTime,\n          }));\n      });\n    }\n    case types.UPDATE_SEARCH: {\n      return state.withMutations((newState) => {\n        const data = filterData({\n          data: state.get('actualData'),\n          filter: state.get('filter'),\n          search: payload,\n          errorFilter: state.get('errorFilter'),\n        });\n        const summary = getSummary(data);\n        newState\n          .set('search', payload)\n          .set('data', data)\n          .setIn(['dataSummary', 'totalRequests'], summary.totalRequests)\n          .setIn(['dataSummary', 'totalTransferredSize'], summary.totalTransferredSize)\n          .setIn(['dataSummary', 'totalUncompressedSize'], summary.totalUncompressedSize);\n      });\n    }\n    case types.UPDATE_FILTER: {\n      return state.withMutations((newState) => {\n        const data = filterData({\n          data: state.get('actualData'),\n          filter: payload,\n          search: state.get('search'),\n          errorFilter: state.get('errorFilter'),\n        });\n        const summary = getSummary(data);\n        newState\n          .set('filter', payload)\n          .set('data', data)\n          .setIn(['dataSummary', 'totalRequests'], summary.totalRequests)\n          .setIn(['dataSummary', 'totalTransferredSize'], summary.totalTransferredSize)\n          .setIn(['dataSummary', 'totalUncompressedSize'], summary.totalUncompressedSize);\n      });\n    }\n    case types.UPDATE_ERROR_FILTER: {\n      return state.withMutations((newState) => {\n        const data = filterData({\n          data: state.get('actualData'),\n          filter: state.get('filter'),\n          search: state.get('search'),\n          errorFilter: payload,\n        });\n        const summary = getSummary(data);\n        newState\n          .set('errorFilter', payload)\n          .set('data', data)\n          .setIn(['dataSummary', 'totalRequests'], summary.totalRequests)\n          .setIn(['dataSummary', 'totalTransferredSize'], summary.totalTransferredSize)\n          .setIn(['dataSummary', 'totalUncompressedSize'], summary.totalUncompressedSize);\n      });\n    }\n    case types.UPDATE_SORT: {\n      return state.withMutations((newState) => {\n        newState\n          .set('sort', payload)\n          .set('data', sortBy(state.get('data'), payload.key, payload.isAcs));\n      });\n    }\n    case types.FETCH_FILE.REQUEST: {\n      return state.withMutations((newState) => {\n        newState\n          .set('error', null)\n          .set('loading', true);\n      });\n    }\n    case types.FETCH_FILE.SUCCESS: {\n      return state.withMutations((newState) => {\n        newState\n          .set('error', null)\n          .set('loading', false);\n      });\n    }\n    case types.FETCH_FILE.FAILURE:\n    case types.UPDATE_ERROR_MESSAGE: {\n      return state.withMutations((newState) => {\n        newState\n          .set('error', payload)\n          .set('loading', false);\n      });\n    }\n    case types.UPDATE_SCROLL_TO_INDEX: {\n      return state.withMutations((newState) => {\n        newState\n          .set('selectedReqIndex', payload ? payload.index : null)\n          .set('reqDetail', payload);\n      });\n    }\n    case types.SELECT_REQUEST: {\n      return state.withMutations((newState) => {\n        newState\n          .set('selectedReqIndex', payload ? payload.index : null)\n          .set('reqDetail', payload)\n          .set('showReqDetail', !!payload);\n      });\n    }\n    case types.RESET: {\n      return initialState;\n    }\n    default:\n      return state;\n  }\n};\n\nexport { initialState, reducer };\nexport default reducer;\n"],"names":["initialState","Map","data","List","actualData","totalNetworkTime","dataSummary","sort","key","isAcs","search","name","value","filter","errorFilter","error","loading","scrollToIndex","selectedReqIndex","showReqDetail","reqDetail","reducer","state","type","payload","types","withMutations","newState","get","prepareViewerData","entries","totalRequests","totalTransferredSize","totalUncompressedSize","finishTime","sortedData","sortBy","set","timings","calculateTimings","pages","finish","filterData","summary","getSummary","setIn","REQUEST","SUCCESS","FAILURE","index"],"mappings":"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"}